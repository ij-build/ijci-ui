<div *ngIf="build">
  <h2>Build {{build.project.name}}</h2>

  <a class="ui basic primary button" (click)="cancel()" *ngIf="!build.canceled && !build.isTerminal()">
    <i class="stop circle icon"></i> Cancel
  </a>

  <a class="ui basic primary button" (click)="requeue()" *ngIf="build.canceled || build.isTerminal()">
    <i class="undo icon"></i> Requeue
  </a>

  <a class="ui basic negative button" (click)="delete()" *ngIf="build.canceled || build.isTerminal()">
    <i class="trash alternate icon"></i> Delete
  </a>

  <a routerLink="/projects/{{build.project.projectId}}">Project Page</a>

  <div appModal class="ui modal">
    <div class="ui icon header">
      <i class="exclamation triangle icon"></i> Delete build?
    </div>
    <div class="content">
      <p>This will delete all associated artifacts and and logs.</p>
    </div>
    <div class="actions">
      <div class="ui basic cancel button"><i class="check icon"></i> No</div>
      <div class="ui red ok button"><i class="delete icon"></i> Delete</div>
    </div>
  </div>

  <div class="ui center aligned basic segment">
    <div class="ui ordered horizontal steps">
      <div class="step" [ngClass]="{'active': build.isQueued() && build.queuedAt == build.createdAt}">
        <div class="content">
          <div class="title">Queued</div>
          <div class="description">{{build.createdAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'active': build.isQueued()}" *ngIf="build.queuedAt != build.createdAt">
        <div class="content">
          <div class="title">Requeued</div>
          <div class="description">{{build.queuedAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'active': build.isInProgress()}" *ngIf="!build.canceled || build.startedAt">
        <div class="content">
          <div class="title">In Progress</div>
          <div class="description">{{build.startedAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step active" *ngIf="build.canceled">
        <div class="content">
          <div class="title">Canceled</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'positive': build.isSucceeded(), 'negative': build.isErrored() || build.isFailed()}" *ngIf="!build.canceled">
        <div class="content">
          <div class="title" *ngIf="!build.isTerminal()">Complete</div>
          <div class="title" *ngIf="build.isTerminal()">{{build.buildStatus | titlecase}}</div>
          <div class="description">{{build.completedAt | date:'short'}}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui segment" *ngIf="build.errorMessage">
    <p>{{build.errorMessage}}</p>
  </div>

  <!-- TODO - show branch if possible -->
  <div class="ui segment" *ngIf="build.commitMessage || build.commitHash">
    <p *ngIf="build.commitMessage">{{build.commitMessage}}</p>
    <p *ngIf="build.commitHash"><i class="icon code"></i> {{build.commitHash.substring(0, 8)}} on {{build.commitBranch}}</p>
    <p *ngIf="build.commitMessage"><i class="icon user"></i> Authored by {{build.commitAuthorName}} <{{build.commitAuthorEmail}}></p>
    <p *ngIf="build.commitMessage"><i class="icon user"></i> Committed by {{build.commitCommitterName}} <{{build.commitCommitterEmail}}></p>
    <p *ngIf="build.commitMessage"><i class="icon clock"></i> Authored {{build.commitAuthoredAt | amCalendar | lowercase}}</p>
    <p *ngIf="build.commitMessage"><i class="icon clock"></i> Committed {{build.commitCommittedAt | amCalendar | lowercase}}</p>
  </div>

  <div *ngIf="build.buildLogs.length > 0">
    <h2>Logs</h2>

    <div *ngFor="let buildLog of build.buildLogs" class="ui accordion field">
      <div appAccordion [enabled]="buildLog.content">
        <div class="title">
          <i class="icon dropdown"></i>
          <span>{{buildLog.name}}</span>
          <span *ngIf="!buildLog.content"> (no content)</span>
        </div>

        <div class="content field" *ngIf="buildLog.content">
          <pre>{{buildLog.content}}</pre>
        </div>
      </div>
    </div>
  </div>
</div>
