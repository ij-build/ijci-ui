<div *ngIf="build">
  <div class="ui two column stackable center aligned grid">
    <div class="twelve wide left aligned column">
      <h2>Build {{build.buildId.substring(0, 8)}} of <a routerLink="/projects/{{build.project.projectId}}">{{build.project.name}}</a></h2>
    </div>

    <div class="four wide right aligned column">
      <div class="ui icon basic buttons">
        <button appPopup class="ui button" data-content="Cancel Build" (click)="cancel()" *ngIf="!build.isTerminal()"><i class="stop circle icon"></i></button>
        <button appPopup class="ui button" data-content="Requeue Build" (click)="requeue()" *ngIf="build.isTerminal()"><i class="undo icon"></i></button>
        <button appPopup class="ui button" data-content="Delete Build" (click)="delete()" *ngIf="build.isTerminal()"><i class="red trash alternate icon"></i></button>
      </div>
    </div>
  </div>

  <div appModal class="ui modal">
    <div class="ui icon header">
      <i class="exclamation triangle icon"></i> Delete build?
    </div>
    <div class="content">
      <p>This will delete all associated artifacts and and logs.</p>
    </div>
    <div class="actions">
      <div class="ui basic cancel button"><i class="check icon"></i> No</div>
      <div class="ui red ok button"><i class="delete icon"></i> Delete</div>
    </div>
  </div>

  <div class="ui center aligned basic segment">
    <div class="ui fluid horizontal steps">
      <div class="step" [ngClass]="{'active': build.isQueued() && build.queuedAt == build.createdAt}">
        <div class="content">
          <div class="title">Queued</div>
          <div class="description">{{build.createdAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'active': build.isQueued()}" *ngIf="build.queuedAt != build.createdAt">
        <div class="content">
          <div class="title">Requeued</div>
          <div class="description">{{build.queuedAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'active': build.isInProgress()}" *ngIf="build.startedAt || !build.isCanceled()">
        <div class="content">
          <div class="title"><i class="notched circle loading icon" *ngIf="build.isInProgress()"></i> In Progress</div>
          <div class="description" *ngIf="build.startedAt">{{build.startedAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step active" *ngIf="build.isCanceled()">
        <div class="content">
          <div class="title">Canceled</div>
          <div class="description">{{build.completedAt | date:'short'}}</div>
        </div>
      </div>

      <div class="step" [ngClass]="{'positive': build.isSucceeded(), 'negative': !build.isSucceeded()}" *ngIf="build.isTerminal() && !build.isCanceled()">
        <div class="content">
          <div class="title" *ngIf="!build.isTerminal()">Complete</div>
          <div class="title" *ngIf="build.isTerminal()">{{build.buildStatus | titlecase}}</div>
          <div class="description">{{build.completedAt | date:'short'}}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui top attached tabular menu">
    <a appTab class="item active" data-tab="meta-tab">Meta</a>
    <a appTab class="item" data-tab="logs-tab">Logs</a>
  </div>

  <div class="ui bottom attached tab segment" data-tab="meta-tab">
    <div class="ui segment" *ngIf="build.errorMessage">
      <p>{{build.errorMessage}}</p>
    </div>

    <div class="ui segment" *ngIf="build.commitMessage || build.commitHash">
      <p *ngIf="build.commitMessage">{{build.commitMessage}}</p>
      <p *ngIf="build.commitHash"><i class="icon code"></i> {{build.commitHash.substring(0, 8)}} on {{build.commitBranch}}</p>
      <p *ngIf="build.commitMessage"><i class="icon user"></i> Authored by {{build.commitAuthorName}} <{{build.commitAuthorEmail}}></p>
      <p *ngIf="build.commitMessage"><i class="icon user"></i> Committed by {{build.commitCommitterName}} <{{build.commitCommitterEmail}}></p>
      <p *ngIf="build.commitMessage"><i class="icon clock"></i> Authored {{build.commitAuthoredAt | amCalendar | lowercase}}</p>
      <p *ngIf="build.commitMessage"><i class="icon clock"></i> Committed {{build.commitCommittedAt | amCalendar | lowercase}}</p>
    </div>
  </div>

  <div class="ui bottom attached tab segment" data-tab="logs-tab">
    <div *ngFor="let buildLog of build.buildLogs" class="ui accordion field">
      <div appAccordion [enabled]="buildLog.content">
        <div class="title">
          <i class="icon dropdown"></i>
          <span>{{buildLog.name}}</span>
          <span *ngIf="!buildLog.content"> (no content)</span>
        </div>

        <div class="content field" *ngIf="buildLog.content">
          <pre>{{buildLog.content}}</pre>
        </div>
      </div>
    </div>
  </div>
</div>
